var e=Object.defineProperty,t=(t,s,i)=>(((t,s,i)=>{s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i})(t,"symbol"!=typeof s?s+"":s,i),i);import{V as s,S as i,P as n,M as o,C as r,a,B as h,b as c,c as d,F as l,d as m,W as u,R as p,e as f,f as w,E as g,g as y,h as v,i as z,D as k,j as x,k as b,l as A,m as C}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const M=`${Date.now()}`;class P{constructor(e=50){t(this,"chunks",new Set),this.chunksize=e}addChunk(e){this.chunks.add(e)}createChunk(e){const t=e.multiplyScalar(this.chunksize),s=new S(this.chunksize,t);this.addChunk(s)}addTo(e){for(const t of this.chunks)t.mesh.position.z=t.offset.z,e.add(t.mesh)}update(e){for(const t of this.chunks)if(t.update(e),t.mesh.position.z>this.chunksize){const e=2*this.chunksize;t.updateOffset(new s(0,0,-e)),t.mesh.position.z-=e}}}class S{constructor(e=50,h=new s){t(this,"height",20),t(this,"smoothing",10),t(this,"segments"),t(this,"simplex"),t(this,"mesh"),t(this,"geometry"),t(this,"material"),this.size=e,this.offset=h,this.size=e,this.segments=e/2,this.offset=h,this.simplex=new i(M),this.geometry=new n(this.size,this.size,this.segments,this.segments),this.setGeometryHeight(),this.material=new o({color:new r(788010)}),this.mesh=new a(this.geometry,this.material)}setGeometryHeight(){const e=this.geometry.getAttribute("position").array;for(let t=2;t<e.length;t+=3){const i=e[t-2]+this.offset.x,n=e[t-1];e[t]=-n;const o=e[t]+this.offset.z;e[t-1]=this.simplex.noise2D(i/this.smoothing,o/this.smoothing)*this.getHeight(new s(i,n,o))}this.geometry.setAttribute("position",new h(e,3)),this.geometry.computeVertexNormals()}getHeight(e){return Math.min(.1*Math.abs(e.x),this.height)}addTo(e){e.add(this.mesh)}update(e){this.mesh.position.z=this.mesh.position.z+e}updateOffset(e){this.offset.add(e),this.updateGeometry()}updateGeometry(){const e=this.geometry.getAttribute("position").array;for(let t=2;t<e.length;t+=3){const i=e[t-2]+this.offset.x,n=e[t-1],o=e[t]+this.offset.z;e[t-1]=this.simplex.noise2D(i/this.smoothing,o/this.smoothing)*this.getHeight(new s(i,n,o))}this.geometry.setAttribute("position",new h(e,3)),this.geometry.computeVertexNormals()}}class F{constructor(e){t(this,"canvas"),t(this,"pink",12327284),t(this,"skyColor",1771323),t(this,"groundColor",788010),t(this,"FOV",45),t(this,"NEAR",1),t(this,"FAR",350),t(this,"terrain"),t(this,"camera"),t(this,"renderer"),t(this,"composer"),t(this,"clock",new c),t(this,"scene",new d),t(this,"animationId",null),this.canvas=e;const i=e.clientWidth/e.clientHeight;this.scene.background=new r(this.skyColor),this.scene.fog=new l(this.pink,1,this.FAR/2),this.scene.add(this.createSkydome()),this.scene.add(this.createSunset()),this.createStars().map((e=>this.scene.add(e))),this.camera=new m(this.FOV,i,this.NEAR,this.FAR),this.camera.position.set(0,6,30),this.scene.add(this.camera),this.terrain=new P(this.FAR),this.terrain.createChunk(new s),this.terrain.createChunk(new s(0,0,-1)),this.terrain.addTo(this.scene),this.renderer=new u({antialias:!0,canvas:e}),this.renderer.setPixelRatio(window.devicePixelRatio||1),this.renderer.toneMapping=p,this.renderer.toneMappingExposure=Math.pow(1,4);const n=new f(this.scene,this.camera),o=new w(.2,.75,2048,0);this.composer=new g(this.renderer),this.composer.addPass(n),this.composer.addPass(o)}createSkydome(){const e={topColor:{value:new r(this.skyColor)},bottomColor:{value:new r(this.pink)},offset:{value:-4},exponent:{value:.2}},t=new y(this.FAR/2,32,15),s=new v({uniforms:e,vertexShader:"\n            varying vec3 vWorldPosition;\n    \n            void main() {\n    \n                vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n                vWorldPosition = worldPosition.xyz;\n    \n                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n    \n            }\n        ",fragmentShader:"\n            uniform vec3 topColor;\n            uniform vec3 bottomColor;\n            uniform float offset;\n            uniform float exponent;\n    \n            varying vec3 vWorldPosition;\n    \n            void main() {\n    \n                float h = normalize(vWorldPosition + offset).y;\n                float w = normalize(vWorldPosition).x;\n                gl_FragColor = vec4(\n                    mix(\n                        bottomColor, \n                        topColor,\n                        max(h / exponent, 0.0)\n                    ),\n                    1.0\n                );\n    \n            }\n        ",side:z});return new a(t,s)}createGround(){const e=new n(this.FAR,this.FAR,100,100),t=new o({color:this.groundColor});t.side=k;const s=new a(e,t);return s.rotateX(Math.PI/2),s}createSunset(e=40){const t=new y(e,e,32),s=new o({color:this.pink}),i=new a(t,s);return i.position.set(0,.35*e,-this.FAR/1.8),i}createStars(){const e=new x,t=[],i=new s;for(let s=0;s<2e3;s++)i.x=2*Math.random()-1,i.y=2*Math.random()-1,i.z=2*Math.random()-1,i.multiplyScalar(3),t.push(i.x,i.y,i.z);e.setAttribute("position",new b(t,3));const n=[5592405,3355443,3815994].reduce(((e,t)=>(e.push(new A({color:t,size:2,sizeAttenuation:!1}),new A({color:t,size:1,sizeAttenuation:!1})),e)),[]),o=n.length,r=[];for(let s=10;s<20;s++){const t=new C(e,n[s%o]);t.rotation.x=2*Math.random(),t.rotation.y=2*Math.random(),t.rotation.z=2*Math.random(),t.scale.setScalar(10*s),t.matrixAutoUpdate=!1,t.updateMatrix(),r.push(t)}return r}resize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.composer.setSize(e,t)}render(){this.terrain.update(.5),this.composer.render(),this.animationId=requestAnimationFrame((()=>this.render()))}stop(){this.animationId&&cancelAnimationFrame(this.animationId)}}const R=document.createElement("template");R.innerHTML='\n    <style>\n        :host {\n            display: block;\n            height: 100%;\n            width: 100%;\n        }\n        canvas {\n            position: relative;\n            height: 100%;\n            width: 100%;\n        }\n    </style>\n    <canvas id="canvas"></canvas>\n';class E extends HTMLElement{constructor(){super(),t(this,"shadow"),t(this,"scene"),this.shadow=this.attachShadow({mode:"open"})}connectedCallback(){this.shadow.appendChild(R.content.cloneNode(!0));const e=this.shadow.host,t=this.shadow.getElementById("canvas");this.scene=new F(t),window.addEventListener("resize",(()=>{var t;null==(t=this.scene)||t.resize(e.clientWidth,e.clientHeight)})),this.scene.resize(e.clientWidth,e.clientHeight),this.scene.render()}disconnectedCallback(){var e;null==(e=this.scene)||e.stop(),this.scene=void 0}}customElements.define("retro-scene",E);
